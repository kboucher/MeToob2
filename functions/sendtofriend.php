<?php /*    File: SendToFriend.php    Description: Called by jQuery AJAX to forward videos via email*/require('../../../../wp-blog-header.php');// Get querystring$json = stripslashes( $_GET["json"] );// Get data object$json_o = json_decode( $json );// Get post$post_id = $json_o -> postId;$the_post = get_post( $post_id );$the_excerpt = $the_post -> post_excerpt;$thumb = wp_get_attachment_image_src( get_post_thumbnail_id( $post_id ), 'single-post-thumbnail' );$title = $the_post -> post_title;$permalink = get_post_permalink( $post_id );$to = $json_o -> email_to;$from = $json_o -> email;// Set message headers$subject = $title . ": Watch it on DiabetesHealthLibrary.com";$headers = "From: " . $from . "\r\n";$headers .= "Reply-To: " . $from . "\r\n";$headers .= "MIME-Version: 1.0\r\n";$headers .= "Content-Type: text/html; charset=ISO-8859-1\r\n";// Set message$message = "<html xmlns=\"http://www.w3.org/1999/xhtml\">";$message .= "<head>";$message .=     "<style type=\"text/css\">";$message .=         "html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre,";$message .=         "a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp,";$message .=         "small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend,";$message .=         "table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, ";$message .=         "figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary,";$message .=         "time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font-weight:normal; font: inherit; vertical-align: baseline; }";$message .=         ".clearfix:after { clear:both; content:'.'; display:block; height:0; visibility:hidden; }";$message .=         ".clearfix:after { clear:both; content:' '; display:block; font-size:0; height:0; visibility:hidden; }";$message .=         ".clearfix { display:inline-block; }";$message .=         "* html .clearfix { height:1%; }";$message .=         ".clearfix { display:block; }";$message .=         "html { background:#fff url(images/bg_Html.gif) repeat-x scroll top left; font-family:Helvetica, Arial, Sans-Serif; font-size:10pt; }";$message .=         "body { color:#272F32; }";$message .=         "#SendToFriend .preview { margin:2em 3em; }";$message .=         "#SendToFriend .preview p { margin:1em 0; }";$message .=         "#SendToFriend .listing { background:#DAEAEF; padding:0.5em; margin-bottom:1em; width:396px; }";$message .=         "#SendToFriend .listing .description h4 a { color:#272F32; }";$message .=         "#SendToFriend .thumbnail { border:solid #9DBDC6 1px; float:left; height:56px; position:relative; width:100px; }";$message .=         "#SendToFriend .thumbnail .playButton { -khtml-opacity:0.5; left:37px; filter:alpha(opacity=50); opacity:0.5; position:absolute; top:15px; }";$message .=         "#SendToFriend .description { float:left; font-size:0.8em; padding:0 0 0 1em; width:258px; }";$message .=         "#SendToFriend .description h4 { font-size:12pt; font-weight:bold; margin-bottom:4px; }";$message .=         "#SendToFriend .description h4 a { color:#769299; text-decoration:none; }";$message .=         "#SendToFriend .description h4 a { color:#272F32; }";$message .=         "#SendToFriend .description p { margin:0; }";$message .=     "</style>";$message .= "</head>";$message .= "<body id=\"SendToFriend\">";$message .= "<div class=\"preview clearfix\">";$message .=     "<p>Your friend at " . $from . " has sent you this informational video...</p>";$message .=     "<div class=\"listing clearfix selected\">";$message .=         "<div class=\"thumbnail\">";$message .=             "<a href=\"" . $permalink . "\" title=\"Play\"><img src=\"" . ( count( $thumb ) > 0 ? $thumb[0] : "No thumbnail" ) . "\" width=\"100\" height=\"56\" alt=\"Play\" /></a>";$message .=             "<a href=\"" . $permalink . "\" title=\"Play\"><img width=\"26\" height=\"26\" alt=\"Play\" src=\"" . get_bloginfo( 'url' ) . "/wp-content/themes/metoob2/images/button_Play-thumbnail.png\" class=\"playButton\" /></a>";$message .=         "</div>";$message .=         "<div class=\"description\">";$message .=             "<h4><a href=\"" . $permalink . "\">" . $title . "</a></h4>";$message .=             "<p>" . $the_excerpt . "...</p>";$message .=         "</div>";$message .=     "</div>";$message .=     "<p>Click the Play button above or click the following link to view this video.</p>";$message .=     "<a href=\"" . $permalink . "\">" . $permalink . "</a>";$message .= "</div>";$message .= "</body>";$message .= "</html>";header("HTTP/1.1 200 OK");try{    mail( $to, $subject, $message, $headers );    $json_response = '{ "Message" : "Success", "SentTo" : "' . $to . '" }';    echo $json_response;}catch ( Exception $e ){    echo "{ 'Message' : '" . $e->getMessage() . "' }";}?>